<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecommerce Chat Support</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 500px;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="relative w-full max-w-2xl bg-white shadow-xl rounded-2xl flex flex-col h-[80vh] overflow-hidden">
        
        <!-- Header -->
        <div class="p-4 border-b border-gray-200 bg-white sticky top-0 z-10 rounded-t-2xl">
            <div class="flex items-center justify-between">
                <div id="chat-header-info" class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">AI</div>
                    <div>
                        <h1 id="chat-title" class="text-xl font-semibold">Ecommerce Chat Support</h1>
                        <p id="chat-subtitle" class="text-sm text-gray-500">How can I assist you today?</p>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button id="faq-button" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-200 transition-colors duration-200">
                        FAQs
                    </button>
                    <button id="dashboard-button" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full text-sm font-medium hover:bg-gray-200 transition-colors duration-200">
                        Dashboard
                    </button>
                    <button id="agent-button" class="bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-blue-600 transition-colors duration-200">
                        Talk to an Agent
                    </button>
                </div>
            </div>
        </div>

        <!-- Chat Container -->
        <div id="chat-container" class="flex-1 p-6 overflow-y-auto space-y-4">
            <!-- Initial bot message -->
            <div class="flex items-start space-x-3">
                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.939c-.198-.44-.316-.91-.35-1.4a5.992 5.992 0 011.009-4.22c.38-.636.817-1.22 1.32-1.745-.045.025-.09.05-.135.074C10.603 9.484 9.172 11.235 9 13.064c-.201 2.87 2.115 5.21 4.966 4.943a1.99 1.99 0 001.385-1.579c.07-.464.113-.938.12-1.411.011-.676-.11-1.345-.333-1.986l-.004-.012c-.223-.64-.537-1.218-.887-1.724a.8.8 0 01.442-1.399c1.47-.393 2.822.427 3.33 1.834.457 1.256.457 2.585 0 3.841-1.47 4.026-6.494 4.026-7.964 0zm0 0c.34-.336.711-.643 1.11-.913.045-.03.09-.059.135-.089a.8.8 0 01.442 1.399c-.854.774-1.921 1.2-2.997 1.215-2.87.201-5.21-2.115-4.943-4.966.07-.638.113-1.27.12-1.907.011-1.349-.11-2.678-.333-3.987l-.004-.012c-.223-1.317-.537-2.587-.887-3.722a.8.8 0 01.442-1.399c1.47-.393 2.822.427 3.33 1.834.457 1.256.457 2.585 0 3.841-1.47 4.026-6.494 4.026-7.964 0z" />
                    </svg>
                </div>
                <div class="bg-gray-100 p-3 rounded-xl max-w-md">
                    <p class="text-sm">Hi there! I'm your AI customer support assistant. How can I help you today? You can ask about **shipping**, **returns**, or **order status**.</p>
                </div>
            </div>
            
        </div>

        <!-- Input and Send Button -->
        <div class="p-4 border-t border-gray-200 bg-white sticky bottom-0 z-10 rounded-b-2xl">
            <div class="relative">
                <input id="message-input" type="text" placeholder="Type your message..." class="w-full pl-4 pr-12 py-3 rounded-full bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow duration-300 placeholder:text-gray-500">
                <button id="send-button" class="absolute inset-y-0 right-0 flex items-center justify-center pr-3 group">
                    <div class="p-2 bg-blue-500 rounded-full transition-all duration-200 group-hover:scale-110">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-white transform rotate-90">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3 21m18-9l-3 9m-9-9h9M3 3l18 18" />
                        </svg>
                    </div>
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading-indicator" class="absolute inset-x-0 bottom-40 w-12 h-12 rounded-full mx-auto hidden">
            <div class="h-full w-full rounded-full bg-blue-500 animate-pulse"></div>
        </div>

    </div>

    <!-- Dashboard Modal -->
    <div id="dashboard-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Support Dashboard</h2>
                <button id="close-modal-button" class="text-gray-500 hover:text-gray-700 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="space-y-4">
                <div class="bg-gray-100 p-4 rounded-xl flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-600">Resolution Rate</span>
                    <span class="text-2xl font-bold text-blue-600">78%</span>
                </div>
                <div class="bg-gray-100 p-4 rounded-xl flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-600">Escalation Rate</span>
                    <span class="text-2xl font-bold text-red-600">12%</span>
                </div>
                <div class="bg-gray-100 p-4 rounded-xl flex justify-between items-center">
                    <span class="text-sm font-medium text-gray-600">Average Response Time</span>
                    <span class="text-2xl font-bold text-green-600">45s</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- FAQ Modal -->
    <div id="faq-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Frequently Asked Questions</h2>
                <button id="close-faq-modal-button" class="text-gray-500 hover:text-gray-700 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <h3 class="font-bold text-lg mb-1">1. Where is my order?</h3>
                    <p class="text-sm text-gray-700">All orders can be tracked using the tracking number provided in your shipping confirmation email.</p>
                </div>
                <hr>
                <div>
                    <h3 class="font-bold text-lg mb-1">2. How do I initiate a return?</h3>
                    <p class="text-sm text-gray-700">To start a return, please visit our Returns Center on our website. You will need your order number and email address.</p>
                </div>
                <hr>
                <div>
                    <h3 class="font-bold text-lg mb-1">3. What is your return policy?</h3>
                    <p class="text-sm text-gray-700">You can return most items within 30 days of delivery. The items must be in new and unused condition with original tags and packaging.</p>
                </div>
                <hr>
                <div>
                    <h3 class="font-bold text-lg mb-1">4. When will I receive my refund?</h3>
                    <p class="text-sm text-gray-700">Once your return is received and inspected, we will send you an email notification. Refunds are typically processed within 5-7 business days.</p>
                </div>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatContainer = document.getElementById('chat-container');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            const loadingIndicator = document.getElementById('loading-indicator');
            const agentButton = document.getElementById('agent-button');
            const chatTitle = document.getElementById('chat-title');
            const chatSubtitle = document.getElementById('chat-subtitle');
            const dashboardButton = document.getElementById('dashboard-button');
            const dashboardModal = document.getElementById('dashboard-modal');
            const closeModalButton = document.getElementById('close-modal-button');
            const faqButton = document.getElementById('faq-button');
            const faqModal = document.getElementById('faq-modal');
            const closeFaqModalButton = document.getElementById('close-faq-modal-button');

            let isAgentChat = false;
            
            // Dummy data for previous orders
            const dummyOrders = [
                { id: '12345', product: 'Wireless Mouse', status: 'Delivered', returnEligibility: true, date: '2025-08-20' },
                { id: '67890', product: 'Ergonomic Keyboard', status: 'Delivered', returnEligibility: false, date: '2025-06-15' },
                { id: '11223', product: 'Laptop Stand', status: 'Shipped', returnEligibility: true, date: '2025-09-01' }
            ];

            // Function to add a message to the chat container
            function addMessage(message, type) {
                const messageWrapper = document.createElement('div');
                messageWrapper.className = `flex items-start space-x-3 transition-opacity duration-300 ease-in-out opacity-0 ${type === 'user' ? 'justify-end' : 'justify-start'}`;

                let contentHtml = '';
                const senderIcon = type === 'user'
                    ? ''
                    : `<div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.939c-.198-.44-.316-.91-.35-1.4a5.992 5.992 0 011.009-4.22c.38-.636.817-1.22 1.32-1.745-.045.025-.09.05-.135.074C10.603 9.484 9.172 11.235 9 13.064c-.201 2.87 2.115 5.21 4.966 4.943a1.99 1.99 0 001.385-1.579c.07-.464.113-.938.12-1.411.011-.676-.11-1.345-.333-1.986l-.004-.012c-.223-.64-.537-1.218-.887-1.724a.8.8 0 01.442-1.399c1.47-.393 2.822.427 3.33 1.834.457 1.256.457 2.585 0 3.841-1.47 4.026-6.494 4.026-7.964 0zm0 0c.34-.336.711-.643 1.11-.913.045-.03.09-.059.135-.089a.8.8 0 01.442 1.399c-.854.774-1.921 1.2-2.997 1.215-2.87.201-5.21-2.115-4.943-4.966.07-.638.113-1.27.12-1.907.011-1.349-.11-2.678-.333-3.987l-.004-.012c-.223-1.317-.537-2.587-.887-3.722a.8.8 0 01.442-1.399c1.47-.393 2.822.427 3.33 1.834.457 1.256.457 2.585 0 3.841-1.47 4.026-6.494 4.026-7.964 0z" />
                        </svg>
                    </div>`;

                if (type === 'user') {
                    contentHtml = `
                        <div class="bg-blue-500 text-white p-3 rounded-xl max-w-md shadow-md">
                            <p class="text-sm">${message}</p>
                        </div>
                    `;
                } else {
                    const isHTML = message.trim().startsWith('<div') || message.trim().startsWith('<p') || message.trim().startsWith('<ul');
                    
                    if (isHTML) {
                        contentHtml = `${senderIcon}<div class="bg-gray-100 p-3 rounded-xl max-w-md shadow-md">${message}</div>`;
                    } else {
                        contentHtml = `${senderIcon}<div class="bg-gray-100 p-3 rounded-xl max-w-md shadow-md"><p class="text-sm">${message}</p></div>`;
                    }
                }

                messageWrapper.innerHTML = contentHtml;
                chatContainer.appendChild(messageWrapper);
                
                setTimeout(() => {
                    messageWrapper.style.opacity = '1';
                }, 10);

                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            async function getGeminiResponse(message) {
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const lowerCaseMessage = message.toLowerCase();

                // Advanced keyword and typo handling for orders and shipping
                const orderKeywords = ["previous orders", "my orders", "last orders", "orderts", "orders", "orderss", "show me orders", "shipment", "shipping"];
                if (orderKeywords.some(keyword => lowerCaseMessage.includes(keyword))) {
                    const ordersHTML = dummyOrders.map(order => 
                        `<div class="bg-white p-4 my-2 rounded-xl shadow-md">
                            <p class="font-semibold text-gray-800">Order ID: <span class="text-blue-600">#${order.id}</span></p>
                            <p class="text-sm text-gray-600">Product: ${order.product}</p>
                            <p class="text-sm text-gray-600">Status: ${order.status}</p>
                            <p class="text-sm text-gray-600">Return Eligible: ${order.returnEligibility ? 'Yes' : 'No'}</p>
                        </div>`
                    ).join('');
                    return `<div class="w-full">${ordersHTML}</div>`;
                }
                
                // Advanced keyword and typo handling for returns and refunds
                const returnKeywords = ["return", "refund", "returns", "refunds", "return an item"];
                if (returnKeywords.some(keyword => lowerCaseMessage.includes(keyword))) {
                    const orderIdMatch = message.match(/(\d{5})/);
                    if (orderIdMatch) {
                        const orderId = orderIdMatch[0];
                        const order = dummyOrders.find(o => o.id === orderId);
                        if (order) {
                            if (order.returnEligibility) {
                                return `I've checked order #${orderId}. It is eligible for return. To initiate a return, please visit our online Returns Center.`;
                            } else {
                                return `I'm sorry, order #${orderId} is no longer eligible for a return as it was delivered on ${order.date}.`;
                            }
                        } else {
                            return `I couldn't find an order with the ID #${orderId}. Please check the number and try again.`;
                        }
                    } else {
                        return "You can return most items within 30 days of delivery. For more details on our return policy and to start the process, please visit our help center. Do you have an order number I can check for you?";
                    }
                }
                
                // General FAQ-style questions
                if (lowerCaseMessage.includes("contact") || lowerCaseMessage.includes("customer service") || lowerCaseMessage.includes("call you")) {
                    return "You can reach our customer support team by phone at 1-800-555-1234 or by emailing support@ecommerce.com.";
                }

                if (lowerCaseMessage.includes("hours") || lowerCaseMessage.includes("open") || lowerCaseMessage.includes("close")) {
                    return "Our customer support team is available Monday to Friday, from 9 AM to 5 PM (EST).";
                }

                if (lowerCaseMessage.includes("shipping policy") || lowerCaseMessage.includes("shipping costs")) {
                    return "Our standard shipping is free for all orders over $50. We also offer expedited shipping options at an additional cost. You can find more details on our Shipping Policy page.";
                }

                if (lowerCaseMessage.includes("payment methods") || lowerCaseMessage.includes("pay")) {
                    return "We accept all major credit cards, as well as PayPal and Apple Pay. For a full list, please see our FAQ page.";
                }
                
                // Generic greetings and fallback
                if (lowerCaseMessage.includes("hello") || lowerCaseMessage.includes("hi") || lowerCaseMessage.includes("hey")) {
                    return "Hello! How can I help you today?";
                } else {
                    return "I'm sorry, I don't have information about that. Please ask about shipping or returns, or connect with a live agent for further assistance.";
                }
            }

            async function sendMessage() {
                const message = messageInput.value.trim();
                if (message === '' || isAgentChat) return;

                addMessage(message, 'user');
                messageInput.value = '';
                loadingIndicator.classList.remove('hidden');

                const botResponse = await getGeminiResponse(message);
                
                loadingIndicator.classList.add('hidden');
                addMessage(botResponse, 'bot');
            }

            function startAgentChat() {
                if (isAgentChat) return;

                isAgentChat = true;
                addMessage("I am now transferring you to a live agent. Please wait a moment while they connect to this chat.", "bot");
                
                chatTitle.textContent = "Live Agent";
                chatSubtitle.textContent = "A human is now assisting you.";
                agentButton.style.display = 'none';
                messageInput.disabled = true;
                messageInput.placeholder = "A human agent will reply shortly...";
                
            }

            function showDashboard() {
                dashboardModal.style.display = 'flex';
            }

            function hideDashboard() {
                dashboardModal.style.display = 'none';
            }

            function showFaq() {
                faqModal.style.display = 'flex';
            }

            function hideFaq() {
                faqModal.style.display = 'none';
            }

            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            agentButton.addEventListener('click', startAgentChat);
            dashboardButton.addEventListener('click', showDashboard);
            closeModalButton.addEventListener('click', hideDashboard);
            faqButton.addEventListener('click', showFaq);
            closeFaqModalButton.addEventListener('click', hideFaq);
        });
    </script>
</body>
</html>
